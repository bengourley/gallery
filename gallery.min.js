/**
 * gallery.js
 * ==========
 * https://github.com/bengourley/gallery
 * Licenced under the New BSD License
 */(function(){function e(t){var n={interval:5e3,transitionTime:300,viewingHeight:500,thumbnailSize:{height:78,width:128},thumbnailTrackHeight:78,animateFn:"animate",structureTemplate:this.structureTemplate,captionTemplate:this.captionTemplate};if(!(this instanceof e))return new e(t);this.options=_.extend({},n,t),this.previous=[],this.interval=null,this.loop=!0;if(typeof this.options.selector=="undefined")throw new Error("`selector` is a required option");this.root=$(this.options.selector),this.root.append(this._renderStructure()),$(window).on("resize",_.bind(this._handleResize,this))}e.prototype.structureTemplate=_.template(['<div class="gallery-container">','  <div class="gallery-main">','    <div class="gallery-controls"/>','    <div class="gallery-loading">Loading…</div>',"  </div>",'  <div class="gallery-caption"/>','  <div class="gallery-thumb-reel">','    <button class="gallery-thumb-reel-left"><i>←</i></button>','    <button class="gallery-thumb-reel-right"><i>→</i></button>','    <div class="gallery-thumb-reel-viewport">','      <div class="gallery-thumb-reel-track"/>',"    </div>","  </div>","</div>"].join("\n")),e.prototype.captionTemplate=_.template(['<p class="gallery-caption-text"><%= caption %></p>','<p class="gallery-caption-count"><%= index %> of <%= total %></p>','<p class="gallery-caption-credit"> Image credit: <%= credit %></p>'].join("\n")),e.prototype.images=function(e){return this.images=e,this._renderThumbReel(),this},e.prototype.next=function(e){return this.goTo(this.index+1,e),this},e.prototype.prev=function(e){return this.goTo(this.index-1,e),this},e.prototype.goTo=function(e,t){t&&clearInterval(this.interval),e===this.images.length&&this.options.loop&&(e=0);if(e<0||e>=this.images.length||e===this.index)return this;$(this).trigger("change",e);var n=this.images[e];return this.current&&this.previous.push(this.current),this.el.loading.css({display:"block",opacity:0}),this.el.loading.stop()[this.options.animateFn]({opacity:1},50),this._renderImage(n,_.bind(this._showNextImage,this)),this.index=e,this},e.prototype.pause=function(){return clearInterval(this.interval),this},e.prototype.resume=function(){return clearInterval(this.interval),this.interval=setInterval(_.bind(function(){this.next()},this),this.options.interval),this.goTo(this.index),this},e.prototype.play=function(e){return clearInterval(this.interval),this.interval=setInterval(_.bind(function(){this.index===this.images.length-1?this.goTo(0):this.next()},this),this.options.interval),this.goTo(e||0),this},e.prototype.updateViewingHeight=function(e){return this.options.viewingHeight=e,this.el.main.height(e),this._updateImage(this.current),this},e.prototype.checkThumbScroll=function(){var e=this.el.thumbReel.find(".gallery-thumb-reel-track"),t=e.find(".gallery-thumbnail").last();t.position().left+t.width()<=e.parent().width()?this.el.thumbReel.addClass("no-scroll"):this.el.thumbReel.removeClass("no-scroll")},e.prototype._renderStructure=function(){this.root.empty(),this.el={};var e=$(this.options.structureTemplate({}));this.el.main=e.find(".gallery-main").height(this.options.viewingHeight),this.el.caption=e.find(".gallery-caption"),this.el.thumbReel=e.find(".gallery-thumb-reel").height(this.options.thumbnailTrackHeight),this.el.thumbReel.find(".gallery-thumb-reel-viewport").height(this.options.thumbnailTrackHeight),this.el.thumbReel.find(".gallery-thumb-reel-left").height(this.options.thumbnailSize.height),this.el.thumbReel.find(".gallery-thumb-reel-right").height(this.options.thumbnailSize.height),this.el.loading=e.find(".gallery-loading").hide(),this.el.controls=e.find(".gallery-controls");var t=$("<button/>").text("Next").addClass("gallery-controls-next").on("click",_.bind(function(){this.next(!0)},this)),n=$("<button/>").text("Prev").addClass("gallery-controls-prev").on("click",_.bind(function(){this.prev(!0)},this));return this.el.controls.append(n).append(t),$(this).on("change",_.bind(function(e,r){r===0?n.addClass("disabled"):n.removeClass("disabled"),r===this.images.length-1?t.addClass("disabled"):t.removeClass("disabled")},this)),e},e.prototype._renderImage=function(e,t){var n=new Image,r=_.bind(function(){var r=$(n);r.attr("alt",e.caption).data("resolution",{height:n.height,width:n.width}),this.current=r,t(r)},this),i=_.bind(function(e){t($(new Image))});return $(n).on("load",r),$(n).on("error",r),$(this).on("change",function(){$(n).off("load"),$(n).off("error")}),n.src=e.full,this},e.prototype._renderThumbReel=function(){var e=this.el.thumbReel.find(".gallery-thumb-reel-track");return _.each(this.images,function(t,n){e.append(this._renderThumb(t,n))},this),$(this).on("change",function(t,n){var r=e.find(".gallery-thumbnail").eq(n);if(r.position().left+r.width()>e.parent().width()-parseInt(e.css("left"),10)){var i=e.find(".gallery-thumbnail").last();e.stop()[this.options.animateFn]({left:Math.max(-(r.position().left+r.width()-e.parent().width()),-(i.position().left+i.width()-e.parent().width()))},300)}else-r.position().left>parseInt(e.css("left"),10)&&e.stop()[this.options.animateFn]({left:-r.position().left},300)}),this.el.thumbReel.find(".gallery-thumb-reel-right").on("click",_.bind(function(){this.pause();var t=e.find(".gallery-thumbnail").last(),n=parseInt(e.css("left"),10),r=-(t.position().left+t.width()-e.parent().width());if(t.position().left+t.width()<=e.parent().width())return;if(n===r)return;e.stop()[this.options.animateFn]({left:Math.max(n-e.parent().width(),r)},300)},this)),this.el.thumbReel.find(".gallery-thumb-reel-left").on("click",_.bind(function(){this.pause();var t=parseInt(e.css("left"),10);e.stop()[this.options.animateFn]({left:Math.min(t+e.parent().width(),0)},300)},this)),this.checkThumbScroll(),this},e.prototype._renderThumb=function(e,t){var n=$("<div/>").addClass("gallery-thumbnail"),r=$("<div/>").addClass("gallery-thumbnail-image");return $(this).on("change",function(e,r){r===t?n.addClass("selected"):n.removeClass("selected")}),n.on("click",_.bind(function(){this.goTo(t,!0)},this)).height(this.options.thumbnailSize.height).width(this.options.thumbnailSize.width),r.css({backgroundImage:"url("+e.thumb+")",backgroundRepeat:"no-repeat",backgroundPosition:"center center",height:this.options.thumbnailSize.height,width:this.options.thumbnailSize.width}),n.append(r),n},e.prototype._updateImage=function(e){var t=e.data("resolution").width,n=e.data("resolution").height,r=this.el.main.width(),i=this.el.main.height(),s=t/r,o=n/i;return s>1||o>1?s>o?(e.width(r),e.height(r/t*n)):(e.height(i),e.width(i/n*t)):(e.width(e.data("resolution").width),e.height(e.data("resolution").height)),e.width()<r?e.css({left:(r-e.width())/2}):e.css({left:0}),e.height()<i?e.css({top:(i-e.height())/2}):e.css({top:0}),this},e.prototype._handleResize=function(){return this._updateImage(this.current),this},e.prototype._showNextImage=function(){return this.el.loading.stop()[this.options.animateFn]({opacity:0},50,_.bind(function(){this.el.loading.css({display:"block",opacity:0})},this)),this.current.css({opacity:0}),this.el.main.prepend(this.current),this.current.stop()[this.options.animateFn]({opacity:1},300),this._updateImage(this.current),this.el.caption.empty().append(this.options.captionTemplate(_.extend({index:this.index+1,total:this.images.length},this.images[this.index]))),this._clearPrevious(),this},e.prototype._clearPrevious=function(){var e;while(this.previous.length)e=this.previous.pop(),e.stop()[this.options.animateFn]({opacity:0},300,_.bind(e.remove,e));return this},window.module&&window.require?window.module("Gallery",function(t){t.exports=e}):window.Gallery=e})();